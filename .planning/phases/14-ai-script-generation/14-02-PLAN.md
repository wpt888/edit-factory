---
phase: 14-ai-script-generation
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - frontend/src/app/scripts/page.tsx
  - frontend/src/components/navbar.tsx
autonomous: true
must_haves:
  truths:
    - "User can navigate to /scripts page from navbar"
    - "User can enter an idea and context, select variant count (1-10), and choose AI provider (Gemini or Claude)"
    - "User can see available segment keywords before generating"
    - "After generation, user sees N script cards that are editable text areas"
    - "User can edit any generated script inline before proceeding"
  artifacts:
    - path: "frontend/src/app/scripts/page.tsx"
      provides: "Script generation and review UI page"
      min_lines: 150
    - path: "frontend/src/components/navbar.tsx"
      provides: "Navigation link to scripts page"
      contains: "scripts"
  key_links:
    - from: "frontend/src/app/scripts/page.tsx"
      to: "/api/v1/scripts/generate"
      via: "apiPost call on generate button click"
      pattern: "apiPost.*scripts/generate"
    - from: "frontend/src/app/scripts/page.tsx"
      to: "/api/v1/scripts/keywords"
      via: "apiGet call on page load"
      pattern: "apiGet.*scripts/keywords"
    - from: "frontend/src/components/navbar.tsx"
      to: "frontend/src/app/scripts/page.tsx"
      via: "Link href to /scripts"
      pattern: "href.*scripts"
---

<objective>
Create the frontend script generation page where users input ideas, select AI provider, generate scripts, and review/edit them.

Purpose: Complete the user-facing workflow for Phase 14 — users need a dedicated page to generate, review, and edit AI scripts before sending them to TTS in later phases.

Output: A functional /scripts page with idea input, provider selection, keyword display, script generation, and inline editing.
</objective>

<execution_context>
@/home/ukfdb/.claude/get-shit-done/workflows/execute-plan.md
@/home/ukfdb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-ai-script-generation/14-01-SUMMARY.md

# Existing patterns
@frontend/src/app/segments/page.tsx — Page structure pattern
@frontend/src/lib/api.ts — API client (apiGet, apiPost)
@frontend/src/components/navbar.tsx — Navigation link pattern
@frontend/src/types/video-processing.ts — Type definition patterns
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create script generation page with full UI workflow</name>
  <files>frontend/src/app/scripts/page.tsx</files>
  <action>
    Create `frontend/src/app/scripts/page.tsx` as a "use client" Next.js page. Follow the existing page patterns (segments/page.tsx for structure).

    **Page layout:**
    - Page title: "AI Script Generator" with subtitle "Generate TTS-ready scripts from your ideas"
    - Two-column layout on desktop (input left, output right), stacked on mobile

    **Left column — Input section:**
    1. **Idea textarea** — Large textarea (4-6 rows) with placeholder "Describe your video idea... (e.g., 'Product review for our new wireless earbuds, emphasizing comfort and battery life')"
       - State: `idea: string`

    2. **Context textarea** — Medium textarea (3-4 rows) with placeholder "Product/brand context... (e.g., 'TechGear Pro is a premium electronics brand targeting young professionals')"
       - State: `context: string`

    3. **Configuration row** (flex row, gap-4):
       - **Variant count** — Number input or select dropdown, 1-10, default 3
         - State: `variantCount: number`
       - **AI Provider** — Select dropdown with options: "Gemini" (value: "gemini"), "Claude" (value: "claude")
         - State: `provider: string`, default "gemini"

    4. **Available Keywords section** — Collapsible section showing segment keywords:
       - Fetch on mount via `apiGet("/scripts/keywords")`
       - Display as small badges/chips: `keywords.map(kw => <Badge variant="outline">{kw}</Badge>)`
       - Show count: "X keywords available for matching"
       - State: `keywords: string[]`, `keywordsLoading: boolean`
       - If no keywords: show message "No segment keywords found. Upload and tag segments first."

    5. **Generate button** — Primary button, full width
       - Text: "Generate Scripts" (or "Generating..." with spinner when loading)
       - Disabled when: idea is empty, or isGenerating is true
       - State: `isGenerating: boolean`
       - onClick: Call `apiPost("/scripts/generate", { idea, context, variant_count: variantCount, provider })`
       - On success: Set `scripts` state with response.scripts
       - On error: Show error toast/message

    **Right column — Output section:**
    1. **Scripts display** — Show when `scripts.length > 0`:
       - Header: "Generated Scripts ({scripts.length})" with provider badge
       - For each script, render a card with:
         - Header: "Script {index + 1}" with word count badge
         - Editable textarea pre-filled with the generated script text
         - The textarea should be resizable and at least 6 rows tall
         - Word count displayed below: "{wordCount} words (~{Math.round(wordCount / 2.5)}s)"
       - State: `scripts: string[]` — mutable array, editing updates the array
       - Use `onChange` on textarea to update specific index in scripts array

    2. **Empty state** — Show when no scripts generated yet:
       - Message: "Enter your idea and click Generate to create scripts"
       - Light gray text, centered

    **Styling:**
    - Use existing Shadcn/UI components: Card, Button, Input, Textarea, Badge, Select, Label
    - Import from `@/components/ui/*`
    - Follow existing page styling patterns (max-w-7xl container, padding)
    - Use Tailwind classes consistent with existing pages

    **API integration:**
    - Use `apiGet` and `apiPost` from `@/lib/api`
    - Handle loading states, errors, and success
    - Parse JSON responses with `.json()` after checking `.ok`

    **Error handling:**
    - If API returns error, display it in a red alert below the generate button
    - State: `error: string | null`
    - Clear error when user starts new generation
  </action>
  <verify>
    - File exists: `ls frontend/src/app/scripts/page.tsx`
    - No TypeScript errors: `cd frontend && npx tsc --noEmit --pretty 2>&1 | head -20` (may show unrelated warnings, check for scripts/page.tsx errors specifically)
    - Page renders: Start dev server, navigate to localhost:3000/scripts
  </verify>
  <done>
    /scripts page exists with idea input, context input, variant count selector, AI provider selector, keyword display, generate button, and editable script output cards. All state management works client-side.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Scripts link to navbar navigation</name>
  <files>frontend/src/components/navbar.tsx</files>
  <action>
    Edit `frontend/src/components/navbar.tsx`:

    Add a "Scripts" entry to the `navLinks` array. Insert it after "Export" and before "Segments" since script generation is a primary workflow step:

    ```typescript
    const navLinks = [
      { label: "Librarie", href: "/librarie" },
      { label: "Export", href: "/library" },
      { label: "Scripts", href: "/scripts" },
      { label: "Segments", href: "/segments" },
      { label: "Usage", href: "/usage" },
      { label: "Settings", href: "/settings" },
    ];
    ```

    This adds the Scripts page to the main navigation between Export and Segments, reflecting the script-first workflow where scripts are generated before segments are matched.
  </action>
  <verify>
    - `grep -c "Scripts" frontend/src/components/navbar.tsx` returns 1
    - `grep "scripts" frontend/src/components/navbar.tsx` shows the href
  </verify>
  <done>
    Navbar includes "Scripts" link pointing to /scripts, positioned in the workflow flow between Export and Segments.
  </done>
</task>

</tasks>

<verification>
1. Navigate to localhost:3000/scripts — page loads with input form and empty output section
2. Navbar shows "Scripts" link that navigates to /scripts
3. Keywords load on page mount (if segments exist in DB)
4. Generate button is disabled when idea is empty
5. After generation (requires backend running with valid API keys), scripts appear as editable cards
</verification>

<success_criteria>
- /scripts page is accessible and renders correctly
- User can input idea, context, select variant count and provider
- Available keywords are displayed from API
- Generated scripts appear as editable text areas
- Navbar includes Scripts navigation link
</success_criteria>

<output>
After completion, create `.planning/phases/14-ai-script-generation/14-02-SUMMARY.md`
</output>
