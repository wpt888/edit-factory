---
phase: 30-frontend-error-handling-adoption
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/app/library/page.tsx
  - frontend/src/app/librarie/page.tsx
  - frontend/src/app/settings/page.tsx
  - frontend/src/components/library/postiz-publish-modal.tsx
  - frontend/src/components/library/segment-selection-modal.tsx
autonomous: true
requirements: [FE-02]
gap_closure: true

must_haves:
  truths:
    - "Every catch block in library/page.tsx, librarie/page.tsx, settings/page.tsx calls handleApiError() instead of console.error()"
    - "Zero alert() calls remain in settings/page.tsx, library/page.tsx, or postiz-publish-modal.tsx"
    - "All API errors in the heaviest pages surface as sonner toasts, not console-only messages"
  artifacts:
    - path: "frontend/src/app/library/page.tsx"
      provides: "handleApiError in all catch blocks"
      contains: "handleApiError"
    - path: "frontend/src/app/librarie/page.tsx"
      provides: "handleApiError in all catch blocks"
      contains: "handleApiError"
    - path: "frontend/src/app/settings/page.tsx"
      provides: "handleApiError + toast replacing all alert() calls"
      contains: "handleApiError"
    - path: "frontend/src/components/library/postiz-publish-modal.tsx"
      provides: "handleApiError + toast replacing all alert() calls"
      contains: "handleApiError"
    - path: "frontend/src/components/library/segment-selection-modal.tsx"
      provides: "handleApiError in all catch blocks"
      contains: "handleApiError"
  key_links:
    - from: "frontend/src/app/library/page.tsx"
      to: "frontend/src/lib/api-error.ts"
      via: "import { handleApiError } from '@/lib/api'"
      pattern: "handleApiError"
    - from: "frontend/src/app/settings/page.tsx"
      to: "sonner toast"
      via: "handleApiError calls toast.error internally"
      pattern: "handleApiError"
---

<objective>
Replace all console.error() in catch blocks and all alert() calls with handleApiError() / toast in the 5 heaviest frontend files (library/page.tsx, librarie/page.tsx, settings/page.tsx, postiz-publish-modal.tsx, segment-selection-modal.tsx).

Purpose: Close FE-02 gap — these 5 files contain ~50 of the 69 console.error occurrences and all 20+ alert() calls. Migrating them eliminates the bulk of inconsistent error handling.
Output: 5 updated files with zero console.error in catch blocks and zero alert() calls.
</objective>

<execution_context>
@/home/ukfdb/.claude/get-shit-done/workflows/execute-plan.md
@/home/ukfdb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/src/lib/api-error.ts
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace console.error/alert in library/page.tsx, librarie/page.tsx, and segment-selection-modal.tsx</name>
  <files>
    frontend/src/app/library/page.tsx
    frontend/src/app/librarie/page.tsx
    frontend/src/components/library/segment-selection-modal.tsx
  </files>
  <action>
For each file, add `import { handleApiError } from "@/lib/api"` if not already present (handleApiError is re-exported from api.ts).

**library/page.tsx** (18 console.error + 2 alert):
- Find every `catch` block containing `console.error(...)` — replace with `handleApiError(error, "context message")` where the context message describes what operation failed (e.g., "Eroare la incarcarea proiectelor", "Eroare la renderizare").
- Replace `alert("Trebuie să asignezi segmente mai întâi!")` (L596) with `toast.error("Trebuie sa asignezi segmente mai intai!")` — this is a validation message, not an API error, so use toast.error directly. Import `toast` from `sonner` if not present.
- Replace `alert(\`Eroare: ${errorMsg}\`)` (L631) with `toast.error(errorMsg || "Eroare la generare")`.
- Do NOT remove `console.error` calls that are in the error-boundary.tsx componentDidCatch or global-error.tsx — those are infrastructure, not catch blocks.

**librarie/page.tsx** (7 console.error):
- Same pattern: replace all `console.error(...)` in catch blocks with `handleApiError(error, "descriptive context")`.

**segment-selection-modal.tsx** (5 console.error):
- Same pattern: replace all `console.error(...)` in catch blocks with `handleApiError(error, "descriptive context")`.

**Important rules:**
- Keep the `error` variable name from the catch — pass it as first arg to handleApiError.
- The second arg to handleApiError is a Romanian fallback message describing the operation.
- If there's useful state cleanup after the error (e.g., setLoading(false)), keep that — handleApiError only handles the notification.
- Remove `console.error` lines entirely — do not leave them alongside handleApiError (no double-logging).
  </action>
  <verify>
Run: `cd /mnt/c/OBSID\ SRL/n8n/edit_factory/frontend && npx next lint --no-cache 2>&1 | head -30`
Run: `grep -c "console.error" frontend/src/app/library/page.tsx frontend/src/app/librarie/page.tsx frontend/src/components/library/segment-selection-modal.tsx` — all should return 0.
Run: `grep -c "alert(" frontend/src/app/library/page.tsx` — should return 0.
  </verify>
  <done>
Zero console.error calls in catch blocks and zero alert() calls across library/page.tsx, librarie/page.tsx, and segment-selection-modal.tsx. All replaced with handleApiError() or toast.error().
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace console.error/alert in settings/page.tsx and postiz-publish-modal.tsx</name>
  <files>
    frontend/src/app/settings/page.tsx
    frontend/src/components/library/postiz-publish-modal.tsx
  </files>
  <action>
**settings/page.tsx** (4 console.error + 13 alert):
- Add `import { handleApiError } from "@/lib/api"` and `import { toast } from "sonner"`.
- Replace all `console.error(...)` in catch blocks with `handleApiError(error, "context")`.
- Replace all `alert("error message")` calls used for error feedback with `toast.error("message")`.
- Replace all `alert("success message")` calls (e.g., "Settings saved successfully", "Account added!", "Connected successfully!") with `toast.success("message")`. Do NOT use handleApiError for success messages.
- For validation alerts like `alert("No profile selected")` or `alert("Please enter both a label and API key")` — replace with `toast.warning("message")` or `toast.error("message")`.

**postiz-publish-modal.tsx** (2 console.error + 6 alert):
- Add `import { handleApiError } from "@/lib/api"` and `import { toast } from "sonner"`.
- Replace `alert("Selecteaza cel putin o platforma!")` with `toast.error("Selecteaza cel putin o platforma!")` — validation message.
- Replace `alert(\`Publicare in curs! Job ID: ...\`)` with `toast.success("Publicare in curs!")` — success message.
- Replace error alerts `alert(\`Eroare: ...\`)` with `handleApiError(error, "Eroare la publicare")` in the catch block.
- Replace fallback `alert("Eroare la publicare. Verifica conexiunea.")` with `handleApiError(error, "Eroare la publicare")`.
- Replace all remaining `console.error(...)` with `handleApiError(error, "context")`.

**Important:** Sonner toast variants: `toast.error()` for errors, `toast.success()` for confirmations, `toast.warning()` for validations. The `handleApiError()` function is only for API error responses caught in catch blocks.
  </action>
  <verify>
Run: `grep -c "alert(" frontend/src/app/settings/page.tsx frontend/src/components/library/postiz-publish-modal.tsx` — both should return 0.
Run: `grep -c "console.error" frontend/src/app/settings/page.tsx frontend/src/components/library/postiz-publish-modal.tsx` — both should return 0.
Run: `grep -c "handleApiError\|toast\." frontend/src/app/settings/page.tsx` — should be > 10 (confirming adoption).
  </verify>
  <done>
Zero console.error calls in catch blocks and zero alert() calls in settings/page.tsx and postiz-publish-modal.tsx. Errors use handleApiError(), validations use toast.warning/error(), successes use toast.success().
  </done>
</task>

</tasks>

<verification>
1. `grep -rn "console.error" frontend/src/app/library/page.tsx frontend/src/app/librarie/page.tsx frontend/src/app/settings/page.tsx frontend/src/components/library/postiz-publish-modal.tsx frontend/src/components/library/segment-selection-modal.tsx` — zero matches
2. `grep -rn "alert(" frontend/src/app/library/page.tsx frontend/src/app/settings/page.tsx frontend/src/components/library/postiz-publish-modal.tsx` — zero matches
3. `grep -c "handleApiError" frontend/src/app/library/page.tsx` — should be >= 15
4. Frontend builds without errors: `cd frontend && npx next build 2>&1 | tail -5`
</verification>

<success_criteria>
- Zero console.error() in catch blocks across the 5 target files
- Zero alert() calls across all 5 target files
- handleApiError() imported and called in every catch block that previously used console.error
- toast.success()/toast.warning() used for non-error alerts (settings confirmations, validations)
- Frontend compiles without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/30-frontend-error-handling-adoption/30-01-SUMMARY.md`
</output>
