---
phase: 06-developer-experience
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - start-dev.bat
  - start-dev.sh
autonomous: true

must_haves:
  truths:
    - "User runs start-dev.bat on Windows and both backend + frontend launch"
    - "User runs start-dev.sh on WSL/Linux and both backend + frontend launch"
    - "Scripts activate correct venv automatically (venv for Windows, venv_linux for WSL)"
    - "Scripts report port conflicts before attempting to start services"
    - "Browser opens to localhost:3000 after services are ready"
    - "User can stop all services with single command"
  artifacts:
    - path: "start-dev.bat"
      provides: "Windows start script"
      min_lines: 80
    - path: "start-dev.sh"
      provides: "WSL/Linux start script"
      min_lines: 150
  key_links:
    - from: "start-dev.bat"
      to: "venv/Scripts/python.exe"
      via: "venv activation"
      pattern: "venv\\\\Scripts"
    - from: "start-dev.sh"
      to: "venv_linux/bin/python"
      via: "venv activation"
      pattern: "venv_linux/bin"
---

<objective>
Create single-command development start scripts for Windows and WSL/Linux.

Purpose: Reduce developer friction by eliminating manual venv activation, separate terminal windows for backend/frontend, and manual browser opening. This is the final phase of the milestone.

Output: Two executable scripts (start-dev.bat and start-dev.sh) that launch the full development environment with one command.
</objective>

<execution_context>
@/home/ukfdb/.claude/get-shit-done/workflows/execute-plan.md
@/home/ukfdb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@run.py
@deploy-local.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Windows start-dev.bat</name>
  <files>start-dev.bat</files>
  <action>
Create a Windows batch script that:

1. **Banner and setup:**
   - Display "EDIT FACTORY - Development Server" banner
   - Set PROJECT_DIR to script directory
   - Define VENV_DIR as %PROJECT_DIR%\venv
   - Define FRONTEND_DIR as %PROJECT_DIR%\frontend

2. **Argument handling:**
   - No args or "all": start both services
   - "stop": stop all services
   - "backend": start only backend
   - "frontend": start only frontend

3. **Port availability check:**
   - Use `netstat -ano | findstr :8000` to check port 8000
   - Use `netstat -ano | findstr :3000` to check port 3000
   - If ports in use, display warning with PID and offer to kill

4. **Prerequisites check:**
   - Check venv\Scripts\python.exe exists, error if missing with setup instructions
   - Check .env exists, error if missing
   - Check frontend\node_modules exists, run `npm install` if missing

5. **Start backend:**
   - Run: `start /B cmd /c "call venv\Scripts\activate.bat && python run.py > logs\backend.log 2>&1"`
   - Note: Use `start /B` to run in background

6. **Start frontend:**
   - Run: `start /B cmd /c "cd frontend && npm run dev > ..\logs\frontend.log 2>&1"`

7. **Wait for services:**
   - Poll localhost:8000/docs with curl (if available) or timeout-based wait
   - Poll localhost:3000 similarly
   - Display READY status for each

8. **Open browser:**
   - After both services ready: `start http://localhost:3000`

9. **Stop services:**
   - Use `taskkill /F /IM python.exe` for backend (may be too aggressive, consider pid file)
   - Use `taskkill /F /IM node.exe` for frontend
   - Alternative: Write PIDs to .backend.pid and .frontend.pid, kill by PID

10. **Display final info:**
    - Show URLs: UI http://localhost:3000, API http://localhost:8000, Docs http://localhost:8000/docs
    - Show log locations
    - Show stop command

Windows-specific considerations:
- Use `call` for venv activation
- Use `start /B` for background processes
- Use `timeout /t N /nobreak` for waiting
- Use `findstr` instead of grep
- Use `%ERRORLEVEL%` for error checking
  </action>
  <verify>
On Windows: run `start-dev.bat` and verify:
- Backend starts (check logs\backend.log for uvicorn output)
- Frontend starts (check logs\frontend.log for Next.js output)
- Browser opens to http://localhost:3000
- `start-dev.bat stop` terminates both processes
  </verify>
  <done>
Windows users can run `start-dev.bat` and get full dev environment running with browser open.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create enhanced start-dev.sh</name>
  <files>start-dev.sh</files>
  <action>
Create a new start-dev.sh script (replacing deploy-local.sh functionality with improvements):

1. **Shebang and settings:**
   - `#!/bin/bash`
   - `set -e` for error exit

2. **Variables:**
   ```bash
   PROJECT_DIR="$(cd "$(dirname "$0")" && pwd)"
   BACKEND_PID_FILE="$PROJECT_DIR/.backend.pid"
   FRONTEND_PID_FILE="$PROJECT_DIR/.frontend.pid"
   VENV_DIR="$PROJECT_DIR/venv_linux"
   FRONTEND_DIR="$PROJECT_DIR/frontend"
   ```

3. **Color codes:**
   - RED, GREEN, YELLOW, CYAN, NC for colored output

4. **Banner function:**
   - Display "EDIT FACTORY - Development Server" banner

5. **stop_services function:**
   - Read PID files if exist, kill processes
   - Kill child processes with `pkill -P`
   - Fallback: kill by port with `lsof -ti:8000` and `lsof -ti:3000`
   - Clean up PID files

6. **check_port function:**
   - Check if port is in use with `lsof -i:$PORT`
   - Return 0 if free, 1 if occupied
   - Display which process is using port

7. **start_backend function:**
   - Check venv_linux/bin/python exists
   - Check .env exists
   - Check/report port 8000 status
   - Run: `"$VENV_DIR/bin/python" run.py > "$PROJECT_DIR/logs/backend.log" 2>&1 &`
   - Save PID to .backend.pid
   - Display status

8. **start_frontend function:**
   - Check frontend/node_modules, run `npm install` if missing
   - Check/report port 3000 status
   - Run: `cd "$FRONTEND_DIR" && npm run dev > "$PROJECT_DIR/logs/frontend.log" 2>&1 &`
   - Save PID to .frontend.pid
   - Display status

9. **wait_for_services function:**
   - Loop with curl to check localhost:8000/docs (max 30 seconds)
   - Loop with curl to check localhost:3000 (max 30 seconds)
   - Display READY or TIMEOUT for each

10. **open_browser function (NEW):**
    - Detect platform: WSL vs native Linux
    - WSL: Use `cmd.exe /c start http://localhost:3000`
    - Linux with xdg-open: Use `xdg-open http://localhost:3000`
    - Linux with gnome-open: Use `gnome-open http://localhost:3000`
    - Fallback: Display URL for manual opening

11. **Main case statement:**
    ```bash
    case "${1:-all}" in
        stop) stop_services ;;
        backend) stop_services; start_backend ;;
        frontend) stop_services; start_frontend ;;
        all|"")
            stop_services
            start_backend
            start_frontend
            wait_for_services
            open_browser
            ;;
    esac
    ```

12. **Final output:**
    - Display all URLs
    - Display stop command
    - Display log file locations

Key improvement over deploy-local.sh: Add browser auto-open with WSL detection.
  </action>
  <verify>
On WSL: run `./start-dev.sh` and verify:
- Backend starts (check logs/backend.log)
- Frontend starts (check logs/frontend.log)
- Browser opens to http://localhost:3000 (Windows browser from WSL)
- `./start-dev.sh stop` terminates both processes
  </verify>
  <done>
WSL/Linux users can run `./start-dev.sh` and get full dev environment running with browser open.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update CLAUDE.md development commands</name>
  <files>CLAUDE.md</files>
  <action>
Update the CLAUDE.md Development Commands section to document the new start scripts:

In the "Development Commands" section, add a new subsection at the TOP (before Backend section):

```markdown
### Quick Start (Recommended)

```bash
# Windows
start-dev.bat

# WSL/Linux
./start-dev.sh

# Stop all services
start-dev.bat stop  # Windows
./start-dev.sh stop # WSL/Linux
```

This launches backend (FastAPI :8000) + frontend (Next.js :3000) + opens browser automatically.
```

This should appear BEFORE the "Backend (FastAPI)" section to guide developers to the simplest path first.
  </action>
  <verify>
Read CLAUDE.md and confirm the Quick Start section exists at the top of Development Commands.
  </verify>
  <done>
CLAUDE.md documents the new start scripts as the recommended development workflow.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Windows test (if available):**
   - Run `start-dev.bat`
   - Verify backend log shows uvicorn running
   - Verify frontend log shows Next.js running
   - Verify browser opened to localhost:3000
   - Run `start-dev.bat stop`
   - Verify processes terminated

2. **WSL test:**
   - Run `chmod +x start-dev.sh && ./start-dev.sh`
   - Verify backend log shows uvicorn running
   - Verify frontend log shows Next.js running
   - Verify browser opened in Windows
   - Run `./start-dev.sh stop`
   - Verify processes terminated

3. **Documentation check:**
   - Confirm CLAUDE.md has Quick Start section
   - Confirm commands are accurate
</verification>

<success_criteria>
Phase 6 is complete when:
- DX-01: `start-dev.bat` (Windows) and `start-dev.sh` (WSL) launch backend + frontend + open browser
- DX-02: Scripts handle venv activation, port availability check, and graceful shutdown
- Both scripts are executable and documented in CLAUDE.md
</success_criteria>

<output>
After completion, create `.planning/phases/06-developer-experience/06-01-SUMMARY.md`
</output>
