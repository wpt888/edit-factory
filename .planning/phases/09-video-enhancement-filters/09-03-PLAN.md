---
phase: 09-video-enhancement-filters
plan: 03
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - frontend/src/components/video-enhancement-controls.tsx
  - frontend/src/app/library/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can enable denoising filter for low-light footage (reduces grain/noise)"
    - "User can enable sharpening filter for soft footage (improves clarity without halos)"
    - "User can adjust color correction (brightness, contrast, saturation sliders)"
    - "Filter settings sent to render API when user clicks render button"
  artifacts:
    - path: "frontend/src/components/video-enhancement-controls.tsx"
      provides: "Reusable filter controls component with checkboxes and sliders"
      contains: "VideoEnhancementControls"
    - path: "frontend/src/app/library/page.tsx"
      provides: "Library page with filter controls in export panel"
      contains: "VideoEnhancementControls"
  key_links:
    - from: "frontend/src/app/library/page.tsx"
      to: "VideoEnhancementControls"
      via: "Component import and usage"
      pattern: "import.*VideoEnhancementControls"
    - from: "frontend/src/app/library/page.tsx"
      to: "/api/v1/library/projects/.*/clips/.*/render"
      via: "fetch with filter FormData"
      pattern: "enable_denoise|enable_sharpen|enable_color"
---

<objective>
Create frontend UI for video enhancement filters with checkboxes to enable/disable and sliders to adjust strength, then integrate into the library page export panel.

Purpose: Enable users to optionally enhance video quality before export - denoise for grainy footage, sharpen for soft focus, color correction for exposure issues.

Output: New VideoEnhancementControls component + library page integration with visual verification
</objective>

<execution_context>
@/home/ukfdb/.claude/get-shit-done/workflows/execute-plan.md
@/home/ukfdb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-video-enhancement-filters/09-RESEARCH.md
@.planning/phases/09-video-enhancement-filters/09-02-SUMMARY.md

# UI patterns
@frontend/src/components/ui/slider.tsx
@frontend/src/components/ui/checkbox.tsx
@frontend/src/app/library/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoEnhancementControls component</name>
  <files>frontend/src/components/video-enhancement-controls.tsx</files>
  <action>
Create new component file with filter controls:

```typescript
"use client"

import * as React from "react"
import { Slider } from "@/components/ui/slider"
import { Checkbox } from "@/components/ui/checkbox"
import { Label } from "@/components/ui/label"

export interface VideoFilters {
  enableDenoise: boolean
  denoiseStrength: number
  enableSharpen: boolean
  sharpenAmount: number
  enableColor: boolean
  brightness: number
  contrast: number
  saturation: number
}

interface VideoEnhancementControlsProps {
  filters: VideoFilters
  onFilterChange: (filters: VideoFilters) => void
  disabled?: boolean
}

export const defaultVideoFilters: VideoFilters = {
  enableDenoise: false,
  denoiseStrength: 2.0,
  enableSharpen: false,
  sharpenAmount: 0.5,
  enableColor: false,
  brightness: 0.0,
  contrast: 1.0,
  saturation: 1.0,
}

export function VideoEnhancementControls({
  filters,
  onFilterChange,
  disabled = false,
}: VideoEnhancementControlsProps) {
  const updateFilters = (updates: Partial<VideoFilters>) => {
    onFilterChange({ ...filters, ...updates })
  }

  return (
    <div className="space-y-4">
      {/* Denoise Section */}
      <div className="space-y-2">
        <div className="flex items-center space-x-2">
          <Checkbox
            id="enable-denoise"
            checked={filters.enableDenoise}
            onCheckedChange={(checked) =>
              updateFilters({ enableDenoise: !!checked })
            }
            disabled={disabled}
          />
          <Label
            htmlFor="enable-denoise"
            className="text-sm font-medium cursor-pointer"
          >
            Denoise (reduce grain)
          </Label>
        </div>

        {filters.enableDenoise && (
          <div className="ml-6 space-y-1">
            <div className="flex justify-between text-xs text-muted-foreground">
              <span>Strength</span>
              <span>{filters.denoiseStrength.toFixed(1)}</span>
            </div>
            <Slider
              value={[filters.denoiseStrength]}
              onValueChange={([value]) =>
                updateFilters({ denoiseStrength: value })
              }
              min={1.0}
              max={4.0}
              step={0.1}
              disabled={disabled}
              className="w-full"
            />
            <p className="text-xs text-muted-foreground">
              Higher = stronger noise reduction (may blur details)
            </p>
          </div>
        )}
      </div>

      {/* Sharpen Section */}
      <div className="space-y-2">
        <div className="flex items-center space-x-2">
          <Checkbox
            id="enable-sharpen"
            checked={filters.enableSharpen}
            onCheckedChange={(checked) =>
              updateFilters({ enableSharpen: !!checked })
            }
            disabled={disabled}
          />
          <Label
            htmlFor="enable-sharpen"
            className="text-sm font-medium cursor-pointer"
          >
            Sharpen (enhance clarity)
          </Label>
        </div>

        {filters.enableSharpen && (
          <div className="ml-6 space-y-1">
            <div className="flex justify-between text-xs text-muted-foreground">
              <span>Amount</span>
              <span>{filters.sharpenAmount.toFixed(2)}</span>
            </div>
            <Slider
              value={[filters.sharpenAmount]}
              onValueChange={([value]) =>
                updateFilters({ sharpenAmount: value })
              }
              min={0.2}
              max={1.0}
              step={0.05}
              disabled={disabled}
              className="w-full"
            />
            <p className="text-xs text-muted-foreground">
              Higher = sharper edges (may create halos if too high)
            </p>
          </div>
        )}
      </div>

      {/* Color Correction Section */}
      <div className="space-y-2">
        <div className="flex items-center space-x-2">
          <Checkbox
            id="enable-color"
            checked={filters.enableColor}
            onCheckedChange={(checked) =>
              updateFilters({ enableColor: !!checked })
            }
            disabled={disabled}
          />
          <Label
            htmlFor="enable-color"
            className="text-sm font-medium cursor-pointer"
          >
            Color Correction
          </Label>
        </div>

        {filters.enableColor && (
          <div className="ml-6 space-y-3">
            <div className="space-y-1">
              <div className="flex justify-between text-xs text-muted-foreground">
                <span>Brightness</span>
                <span>
                  {filters.brightness > 0 ? "+" : ""}
                  {filters.brightness.toFixed(2)}
                </span>
              </div>
              <Slider
                value={[filters.brightness]}
                onValueChange={([value]) =>
                  updateFilters({ brightness: value })
                }
                min={-0.2}
                max={0.2}
                step={0.01}
                disabled={disabled}
                className="w-full"
              />
            </div>

            <div className="space-y-1">
              <div className="flex justify-between text-xs text-muted-foreground">
                <span>Contrast</span>
                <span>{filters.contrast.toFixed(2)}x</span>
              </div>
              <Slider
                value={[filters.contrast]}
                onValueChange={([value]) => updateFilters({ contrast: value })}
                min={0.8}
                max={1.3}
                step={0.05}
                disabled={disabled}
                className="w-full"
              />
            </div>

            <div className="space-y-1">
              <div className="flex justify-between text-xs text-muted-foreground">
                <span>Saturation</span>
                <span>{filters.saturation.toFixed(2)}x</span>
              </div>
              <Slider
                value={[filters.saturation]}
                onValueChange={([value]) =>
                  updateFilters({ saturation: value })
                }
                min={0.8}
                max={1.2}
                step={0.05}
                disabled={disabled}
                className="w-full"
              />
            </div>
          </div>
        )}
      </div>
    </div>
  )
}
```

Key design decisions:
- Sliders only visible when checkbox enabled (less visual clutter)
- Conservative slider ranges to prevent over-processing
- Descriptive help text for each control
- Disabled state support for when rendering is in progress
- Export defaultVideoFilters for easy state initialization
  </action>
  <verify>
Check component file exists and has expected structure:
`ls -la frontend/src/components/video-enhancement-controls.tsx && grep "VideoEnhancementControls" frontend/src/components/video-enhancement-controls.tsx`
  </verify>
  <done>
VideoEnhancementControls component created with checkbox + slider UI for denoise, sharpen, and color correction
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate filters into library page export panel</name>
  <files>frontend/src/app/library/page.tsx</files>
  <action>
Update library page to include filter controls and send filter data to render API:

1. Add import at top of file:
   ```typescript
   import {
     VideoEnhancementControls,
     VideoFilters,
     defaultVideoFilters,
   } from "@/components/video-enhancement-controls"
   ```

2. Add state for video filters (near other state declarations):
   ```typescript
   const [videoFilters, setVideoFilters] = useState<VideoFilters>(defaultVideoFilters)
   ```

3. Find the export panel section (around line 2295-2330 where Platform Selector is located). Add VideoEnhancementControls BEFORE the Platform Selector:
   ```tsx
   {/* Video Enhancement Filters */}
   <div className="mb-4">
     <Label className="text-sm mb-2 block">Video Enhancement (optional):</Label>
     <VideoEnhancementControls
       filters={videoFilters}
       onFilterChange={setVideoFilters}
       disabled={rendering}
     />
   </div>

   {/* Platform Selector */}
   <div className="mb-4">
     <Label className="text-sm mb-2 block">Export for:</Label>
     ...
   ```

4. Find the renderFinalClip function (or equivalent that calls the render API). Update the FormData to include filter parameters:
   ```typescript
   // Inside the render function, when building FormData:
   const formData = new FormData()
   // ... existing fields ...

   // Video enhancement filters (Phase 9)
   formData.append("enable_denoise", videoFilters.enableDenoise.toString())
   formData.append("denoise_strength", videoFilters.denoiseStrength.toString())
   formData.append("enable_sharpen", videoFilters.enableSharpen.toString())
   formData.append("sharpen_amount", videoFilters.sharpenAmount.toString())
   formData.append("enable_color", videoFilters.enableColor.toString())
   formData.append("brightness", videoFilters.brightness.toString())
   formData.append("contrast", videoFilters.contrast.toString())
   formData.append("saturation", videoFilters.saturation.toString())
   ```

5. Reset filters when clip selection changes (optional but good UX):
   ```typescript
   // In the effect or handler that runs when selectedClip changes
   setVideoFilters(defaultVideoFilters)
   ```

The filter controls should appear above the platform selector, creating a logical flow:
1. Edit subtitles (existing tabs)
2. Configure video enhancement (new)
3. Select export platform (existing)
4. Click render button
  </action>
  <verify>
Build check: `cd frontend && npm run build` (should complete without errors)
Check integration: `grep "VideoEnhancementControls" frontend/src/app/library/page.tsx`
  </verify>
  <done>
Library page imports VideoEnhancementControls, renders it in export panel, and sends filter parameters to render API
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Video enhancement filter UI integrated into library page export panel:
- Denoise checkbox + strength slider (1.0-4.0)
- Sharpen checkbox + amount slider (0.2-1.0)
- Color correction checkbox + brightness/contrast/saturation sliders
- Filter controls positioned above platform selector
- Sliders only visible when corresponding checkbox enabled
  </what-built>
  <how-to-verify>
1. Start the application: `./start-dev.sh` (or `start-dev.bat` on Windows)
2. Open browser to http://localhost:3000/library
3. Create or select an existing project with clips
4. Select a clip to open the editing panel
5. Verify the "Video Enhancement (optional)" section appears above "Export for:"
6. Check each filter control:
   - Enable "Denoise" checkbox - strength slider should appear
   - Enable "Sharpen" checkbox - amount slider should appear
   - Enable "Color Correction" checkbox - three sliders should appear (brightness, contrast, saturation)
7. Disable checkboxes - corresponding sliders should hide
8. Click "RandeazÄƒ" button - render should start (filter params sent to API)

Expected visual appearance:
- Collapsible filter sections with checkboxes
- Slider values displayed next to labels
- Help text under each slider explaining the effect
- Smooth expand/collapse animation when toggling checkboxes
  </how-to-verify>
  <resume-signal>Type "approved" if UI appears correctly and filter controls work, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Component exists: `frontend/src/components/video-enhancement-controls.tsx` created
2. Import works: Library page imports VideoEnhancementControls without errors
3. Build passes: `npm run build` completes successfully
4. UI visible: Filter controls appear in export panel above platform selector
5. API integration: FormData includes all 8 filter parameters when render is clicked
</verification>

<success_criteria>
- VideoEnhancementControls component exists with checkbox + slider UI
- Library page renders filter controls in export panel
- Filter state managed correctly (toggles show/hide sliders)
- Render API receives filter parameters via FormData
- Build completes without TypeScript errors
- User confirms visual appearance via checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/09-video-enhancement-filters/09-03-SUMMARY.md`
</output>
