---
phase: 03-frontend-profile-ui
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - frontend/src/components/create-profile-dialog.tsx
  - frontend/src/components/profile-switcher.tsx
autonomous: true

must_haves:
  truths:
    - "User can open create profile dialog from dropdown menu"
    - "User can enter profile name and description in dialog"
    - "User can switch between profiles via radio items in dropdown"
    - "Currently selected profile is visually indicated in dropdown"
  artifacts:
    - path: "frontend/src/components/create-profile-dialog.tsx"
      provides: "Modal dialog for creating new profiles"
      exports: ["CreateProfileDialog"]
      min_lines: 50
    - path: "frontend/src/components/profile-switcher.tsx"
      provides: "Dropdown menu for switching profiles"
      exports: ["ProfileSwitcher"]
      min_lines: 60
  key_links:
    - from: "frontend/src/components/create-profile-dialog.tsx"
      to: "/api/v1/profiles"
      via: "apiPost for creating profile"
      pattern: "apiPost.*profiles"
    - from: "frontend/src/components/create-profile-dialog.tsx"
      to: "profile-context"
      via: "refreshProfiles after creation"
      pattern: "refreshProfiles"
    - from: "frontend/src/components/profile-switcher.tsx"
      to: "profile-context"
      via: "useProfile for profiles and setCurrentProfile"
      pattern: "useProfile"
    - from: "frontend/src/components/profile-switcher.tsx"
      to: "create-profile-dialog"
      via: "opening dialog on menu item click"
      pattern: "CreateProfileDialog"
---

<objective>
Create the UI components for profile management: a dropdown switcher and a create dialog.

Purpose: These components enable users to interact with profiles - switching between existing profiles and creating new ones. They consume the ProfileProvider context created in 03-01.

Output: ProfileSwitcher dropdown component and CreateProfileDialog modal component.
</objective>

<execution_context>
@/home/ukfdb/.claude/get-shit-done/workflows/execute-plan.md
@/home/ukfdb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-frontend-profile-ui/03-RESEARCH.md
@.planning/phases/03-frontend-profile-ui/03-01-SUMMARY.md

# Component patterns to follow
@frontend/src/components/ui/dropdown-menu.tsx
@frontend/src/components/ui/dialog.tsx
@frontend/src/components/ui/button.tsx
@frontend/src/components/ui/input.tsx
@frontend/src/components/ui/label.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CreateProfileDialog component</name>
  <files>frontend/src/components/create-profile-dialog.tsx</files>
  <action>
Create new file `frontend/src/components/create-profile-dialog.tsx` implementing:

1. Props interface:
```typescript
interface CreateProfileDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}
```

2. Component implementation:
   - "use client" directive
   - Use Dialog, DialogContent, DialogHeader, DialogTitle from @/components/ui/dialog
   - Use Input, Label from @/components/ui
   - Use Button from @/components/ui/button
   - Import useProfile hook from @/contexts/profile-context
   - Import apiPost from @/lib/api
   - Import toast from sonner

3. State:
   - name: string (required)
   - description: string (optional)
   - loading: boolean

4. handleCreate function:
   - Validate name is not empty (toast.error if empty)
   - POST to /profiles with { name, description }
   - On success: toast.success, call refreshProfiles(), close dialog, reset form
   - On error: toast.error with error.detail or fallback message
   - Always setLoading(false) in finally

5. Form layout:
   - Profile Name input (required, placeholder: "e.g., Personal, Work, Client X")
   - Description input (optional, placeholder: "Brief description")
   - Cancel and Create buttons in DialogFooter
   - Create button shows "Creating..." when loading

AVOID: Not resetting form fields after successful creation. AVOID: Not calling refreshProfiles (stale dropdown).
  </action>
  <verify>
File exists and exports CreateProfileDialog. TypeScript compilation passes: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>
CreateProfileDialog component created with form validation, API call, and profile list refresh.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create ProfileSwitcher dropdown component</name>
  <files>frontend/src/components/profile-switcher.tsx</files>
  <action>
Create new file `frontend/src/components/profile-switcher.tsx` implementing:

1. Component implementation:
   - "use client" directive
   - Import DropdownMenu components from @/components/ui/dropdown-menu:
     - DropdownMenu, DropdownMenuTrigger, DropdownMenuContent
     - DropdownMenuRadioGroup, DropdownMenuRadioItem
     - DropdownMenuSeparator, DropdownMenuLabel, DropdownMenuItem
   - Import Button from @/components/ui/button
   - Import ChevronDown, Plus, User icons from lucide-react
   - Import useProfile from @/contexts/profile-context
   - Import CreateProfileDialog from ./create-profile-dialog
   - Import Skeleton from @/components/ui/skeleton (or inline skeleton div)

2. State:
   - createDialogOpen: boolean (for dialog visibility)

3. Loading state handling:
   - If isLoading from useProfile, render a skeleton placeholder (w-32 h-9)

4. Dropdown structure:
   - Trigger: Button with variant="outline", showing currentProfile?.name or "Select Profile"
   - ChevronDown icon in trigger
   - Content aligned "end" with w-56 width
   - DropdownMenuLabel: "Switch Profile"
   - DropdownMenuSeparator
   - DropdownMenuRadioGroup:
     - value={currentProfile?.id}
     - onValueChange: find profile by ID, call setCurrentProfile
     - Map profiles to DropdownMenuRadioItem with profile.name
   - DropdownMenuSeparator
   - DropdownMenuItem: "Create New Profile" with Plus icon
     - onClick: setCreateDialogOpen(true)

5. Render CreateProfileDialog at bottom with open/onOpenChange props

6. Handle empty profiles state:
   - If profiles.length === 0 and not loading, show "No profiles" message

AVOID: Not handling loading state (causes hydration mismatch). AVOID: Forgetting to render CreateProfileDialog.
  </action>
  <verify>
File exists and exports ProfileSwitcher. TypeScript compilation passes: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>
ProfileSwitcher dropdown component created with radio selection for profiles and trigger for create dialog.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`
2. CreateProfileDialog exports: grep for "export.*CreateProfileDialog"
3. ProfileSwitcher exports: grep for "export.*ProfileSwitcher"
4. ProfileSwitcher imports CreateProfileDialog: grep for "import.*CreateProfileDialog"
5. Both components use useProfile hook: grep for "useProfile"
</verification>

<success_criteria>
- frontend/src/components/create-profile-dialog.tsx exists and exports CreateProfileDialog
- frontend/src/components/profile-switcher.tsx exists and exports ProfileSwitcher
- ProfileSwitcher renders CreateProfileDialog and controls its open state
- Both components properly use the useProfile hook from context
- TypeScript compilation passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-frontend-profile-ui/03-02-SUMMARY.md`
</output>
