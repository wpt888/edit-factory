---
phase: 07-platform-export-presets
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - frontend/src/app/library/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can see a dropdown to select export platform (TikTok, Reels, YouTube Shorts, Generic)"
    - "User selecting a different platform updates the selectedPreset state"
    - "Render button uses the user-selected preset when exporting"
    - "Platform icons display next to each option (Instagram, YouTube, TikTok icons)"
    - "Selected preset persists in localStorage config"
  artifacts:
    - path: "frontend/src/app/library/page.tsx"
      provides: "Platform selector dropdown in library export UI"
      contains: "SelectItem.*tiktok"
  key_links:
    - from: "frontend/src/app/library/page.tsx"
      to: "API_URL/library/export-presets"
      via: "fetchPresets() already exists"
      pattern: "fetch.*export-presets"
    - from: "frontend/src/app/library/page.tsx"
      to: "selectedPreset state"
      via: "Select onValueChange"
      pattern: "setSelectedPreset"
---

<objective>
Add a visible platform selector dropdown to the library page export UI, allowing users to choose between TikTok, Instagram Reels, YouTube Shorts, and Generic presets before rendering.

Purpose: Without this UI component, users cannot select their target platform - the preset is always defaulted. This completes the user-facing export workflow.

Output: Platform selector dropdown in library page that integrates with existing preset state
</objective>

<execution_context>
@/home/ukfdb/.claude/get-shit-done/workflows/execute-plan.md
@/home/ukfdb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-platform-export-presets/07-RESEARCH.md

# Existing implementation with preset state (already has presets, selectedPreset, fetchPresets)
@frontend/src/app/library/page.tsx
@frontend/src/components/ui/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add platform selector dropdown to library export section</name>
  <files>frontend/src/app/library/page.tsx</files>
  <action>
Add a visible Select dropdown for platform selection in the library page. The state and API integration already exist - we just need the UI component.

1. **Locate the render/export controls section** in the library page JSX (look for the section with "Render" or "Export" buttons, likely near the bulk action buttons or individual clip actions).

2. **Add the preset selector near the render controls:**
   ```tsx
   {/* Platform Export Preset Selector */}
   <div className="flex items-center gap-2">
     <Label className="text-sm whitespace-nowrap">Export for:</Label>
     <Select
       value={selectedPreset}
       onValueChange={(value) => setSelectedPreset(value)}
     >
       <SelectTrigger className="w-40 h-8">
         <SelectValue placeholder="Select platform" />
       </SelectTrigger>
       <SelectContent>
         {presets.length > 0 ? (
           presets.map((preset) => (
             <SelectItem key={preset.name} value={preset.name}>
               <div className="flex items-center gap-2">
                 {getPresetIcon(preset.name)}
                 <span>{preset.display_name}</span>
               </div>
             </SelectItem>
           ))
         ) : (
           <>
             <SelectItem value="instagram_reels">
               <div className="flex items-center gap-2">
                 <Instagram className="h-4 w-4" />
                 <span>Instagram Reels</span>
               </div>
             </SelectItem>
             <SelectItem value="tiktok">
               <div className="flex items-center gap-2">
                 <Film className="h-4 w-4" />
                 <span>TikTok</span>
               </div>
             </SelectItem>
             <SelectItem value="youtube_shorts">
               <div className="flex items-center gap-2">
                 <Youtube className="h-4 w-4" />
                 <span>YouTube Shorts</span>
               </div>
             </SelectItem>
             <SelectItem value="generic">
               <div className="flex items-center gap-2">
                 <Film className="h-4 w-4" />
                 <span>Generic</span>
               </div>
             </SelectItem>
           </>
         )}
       </SelectContent>
     </Select>
   </div>
   ```

3. **Ensure imports are present** (most should already exist):
   ```tsx
   import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
   import { Instagram, Youtube, Film } from "lucide-react";
   ```

4. **Place the selector in a logical location:**
   - Option A: In the toolbar/header area near bulk actions
   - Option B: Above the clip grid, in a settings row
   - Option C: In each clip's action menu (if render is per-clip)

   Most likely Option A or B - look for where the existing render/export buttons are.

5. **Verify the getPresetIcon helper function exists** (it was found in the code):
   ```tsx
   const getPresetIcon = (name: string) => {
     if (name.includes("instagram")) return <Instagram className="h-4 w-4" />;
     if (name.includes("youtube")) return <Youtube className="h-4 w-4" />;
     if (name.includes("tiktok")) return <Film className="h-4 w-4" />;
     return <Film className="h-4 w-4" />;
   };
   ```

Important:
- The `presets`, `selectedPreset`, `setSelectedPreset`, and `fetchPresets` already exist in the component
- The config save/load already handles `selectedPreset` persistence
- Just need to add the visible UI element
  </action>
  <verify>
1. Check Select component is imported and used:
```bash
grep -n "Select.*selectedPreset\|selectedPreset.*Select" "/mnt/c/OBSID SRL/n8n/edit_factory/frontend/src/app/library/page.tsx" | head -5
```

2. Check SelectItem exists for presets:
```bash
grep -n "SelectItem.*tiktok\|SelectItem.*reels\|SelectItem.*youtube" "/mnt/c/OBSID SRL/n8n/edit_factory/frontend/src/app/library/page.tsx" | head -5
```

3. Verify no TypeScript errors:
```bash
cd "/mnt/c/OBSID SRL/n8n/edit_factory/frontend" && npm run lint 2>&1 | head -20
```
  </verify>
  <done>
- Select dropdown for platform selection is visible in library page
- Uses existing presets array from API or fallback static options
- onValueChange calls setSelectedPreset (existing function)
- Platform icons display next to each option
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify platform selector UI and functionality</name>
  <what-built>
Platform selector dropdown in library page that allows users to choose export preset (TikTok, Instagram Reels, YouTube Shorts, Generic) before rendering.
  </what-built>
  <how-to-verify>
1. Start the frontend: `cd frontend && npm run dev`
2. Navigate to http://localhost:3000/library
3. Look for the "Export for:" dropdown selector
4. Click the dropdown - should show platform options with icons
5. Select "TikTok" - the dropdown should update to show TikTok selected
6. Refresh the page - the selection should persist (localStorage)
7. (Optional) If you have a project with clips, try rendering - it should use the selected preset

Expected behavior:
- Dropdown is visible and clickable
- Shows 4 platform options (Instagram Reels, TikTok, YouTube Shorts, Generic)
- Each option has an appropriate icon
- Selection persists across page refresh
  </how-to-verify>
  <resume-signal>Type "approved" if the dropdown works correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
1. Platform selector dropdown is visible in library page UI
2. Dropdown shows all 4 platform options with icons
3. Selecting a platform updates the state
4. Selection persists in localStorage
</verification>

<success_criteria>
- ENC-01 UI component satisfied: Users can select export platform from dropdown
- Selection integrates with existing preset state and render flow
- Screenshot shows visible, functional platform selector
</success_criteria>

<output>
After completion, create `.planning/phases/07-platform-export-presets/07-03-SUMMARY.md`

Include a Playwright screenshot of the platform selector dropdown in the summary.
</output>
