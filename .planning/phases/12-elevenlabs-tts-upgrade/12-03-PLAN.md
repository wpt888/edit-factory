---
phase: 12-elevenlabs-tts-upgrade
plan: 03
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - frontend/src/app/library/page.tsx
  - frontend/src/types/video-processing.ts
autonomous: false

must_haves:
  truths:
    - "User can select ElevenLabs model (flash v2.5, v3, multilingual v2) before rendering"
    - "Selected model is sent as elevenlabs_model parameter in render request"
    - "Model selector shows cost and latency differences between models"
    - "Default selection is eleven_flash_v2_5"
  artifacts:
    - path: "frontend/src/app/library/page.tsx"
      provides: "Model selector dropdown in render section"
      contains: "elevenlabs_model"
    - path: "frontend/src/types/video-processing.ts"
      provides: "ElevenLabs model type definition"
      contains: "ElevenLabsModel"
  key_links:
    - from: "frontend/src/app/library/page.tsx"
      to: "/api/v1/library/clips/{clip_id}/render"
      via: "FormData.append('elevenlabs_model', selectedModel)"
      pattern: "elevenlabs_model"
---

<objective>
Add an ElevenLabs model selector dropdown to the library page's render section, allowing users to
choose between `eleven_flash_v2_5` (fast/cheap), `eleven_turbo_v2_5` (fast/quality), and
`eleven_multilingual_v2` (highest quality) before rendering. The selected model is sent as the
`elevenlabs_model` Form parameter to the render endpoint.

Purpose: Completes TTS-04 (user can select ElevenLabs model per render) with a clear UI
showing cost/latency tradeoffs between models.

Output:
- Model selector component in library page render section
- Model type definitions
- Render function sends selected model to backend
</objective>

<execution_context>
@/home/ukfdb/.claude/get-shit-done/workflows/execute-plan.md
@/home/ukfdb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-elevenlabs-tts-upgrade/12-01-SUMMARY.md

@frontend/src/app/library/page.tsx
@frontend/src/types/video-processing.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add model type and selector to library page render flow</name>
  <files>frontend/src/types/video-processing.ts, frontend/src/app/library/page.tsx</files>
  <action>
  **1. Add type definitions (frontend/src/types/video-processing.ts):**

  Add at the end of the file:
  ```typescript
  /** ElevenLabs model options for TTS generation */
  export interface ElevenLabsModelOption {
    id: string;
    name: string;
    description: string;
    costPer1kChars: number;
    latencyMs: number;
  }

  export const ELEVENLABS_MODELS: ElevenLabsModelOption[] = [
    {
      id: "eleven_flash_v2_5",
      name: "Flash v2.5",
      description: "Fastest, lowest cost, 32 languages",
      costPer1kChars: 0.11,
      latencyMs: 75,
    },
    {
      id: "eleven_turbo_v2_5",
      name: "Turbo v2.5",
      description: "Fast with higher quality, 32 languages",
      costPer1kChars: 0.11,
      latencyMs: 135,
    },
    {
      id: "eleven_multilingual_v2",
      name: "Multilingual v2",
      description: "Highest quality, 29 languages",
      costPer1kChars: 0.22,
      latencyMs: 275,
    },
  ];
  ```

  **2. Add model selector state to library page (frontend/src/app/library/page.tsx):**

  - Import `ELEVENLABS_MODELS` from `@/types/video-processing` (add to existing import).
  - Add state variable near other render state (around the `selectedPreset` state):
    ```typescript
    const [selectedElevenLabsModel, setSelectedElevenLabsModel] = useState("eleven_flash_v2_5");
    ```
  - Import `Select, SelectContent, SelectItem, SelectTrigger, SelectValue` from
    `@/components/ui/select` if not already imported (Shadcn/UI select component).

  **3. Add model selector UI in the render section:**

  Find the render controls area (near where preset selection exists, before the Render button).
  Add a model selector dropdown:
  ```tsx
  {/* ElevenLabs Model Selection (Phase 12) */}
  <div className="space-y-2">
    <label className="text-sm font-medium text-zinc-400">
      TTS Model
    </label>
    <Select
      value={selectedElevenLabsModel}
      onValueChange={setSelectedElevenLabsModel}
    >
      <SelectTrigger className="w-full bg-zinc-800 border-zinc-700">
        <SelectValue placeholder="Select model" />
      </SelectTrigger>
      <SelectContent>
        {ELEVENLABS_MODELS.map((model) => (
          <SelectItem key={model.id} value={model.id}>
            <div className="flex items-center justify-between w-full gap-4">
              <span>{model.name}</span>
              <span className="text-xs text-zinc-500">
                ${model.costPer1kChars}/1k chars · {model.latencyMs}ms
              </span>
            </div>
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
    <p className="text-xs text-zinc-500">
      {ELEVENLABS_MODELS.find(m => m.id === selectedElevenLabsModel)?.description}
    </p>
  </div>
  ```

  **4. Update renderFinalClip function:**

  In the `renderFinalClip` function, add the model to the FormData:
  ```typescript
  formData.append("elevenlabs_model", selectedElevenLabsModel);
  ```
  Place this after the existing `formData.append("preset_name", selectedPreset);` line.

  **5. Update renderAllSelected function (bulk render):**

  If there is a bulk render function that also calls the render endpoint, add the same
  `elevenlabs_model` parameter to its request body or FormData.
  Look for `bulk-render` endpoint call and add `elevenlabs_model: selectedElevenLabsModel`
  to the JSON body.

  DESIGN NOTES:
  - Match existing dark theme: `bg-zinc-800 border-zinc-700 text-zinc-400` pattern.
  - Place the model selector near other render settings (preset, filters) so it feels natural.
  - The selector should only appear when the clip has TTS text (content_data.tts_text is set).
    However, for simplicity, always show it — it's ignored if no TTS text is present.
  </action>
  <verify>
  Run: `cd "/mnt/c/OBSID SRL/n8n/edit_factory/frontend" && npx tsc --noEmit --pretty 2>&1 | head -20` to check for TypeScript errors.

  Grep for `elevenlabs_model` in `frontend/src/app/library/page.tsx` to confirm it's in the render FormData.
  Grep for `ELEVENLABS_MODELS` in `frontend/src/types/video-processing.ts` to confirm type definitions.
  </verify>
  <done>
  - `ELEVENLABS_MODELS` constant with 3 model options defined in types file
  - Model selector dropdown in library page render section
  - `renderFinalClip()` sends `elevenlabs_model` parameter in FormData
  - Bulk render also sends model selection
  - Default is `eleven_flash_v2_5`
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of model selector</name>
  <files>frontend/src/app/library/page.tsx</files>
  <action>
  CHECKPOINT: Verify ElevenLabs model selector dropdown visually.

  What was built: ElevenLabs model selector dropdown in the library page render section.
  When opening the render dialog for a clip, there should be a "TTS Model" dropdown showing
  three options: Flash v2.5 (default), Turbo v2.5, and Multilingual v2, each with cost and
  latency info.

  Steps to verify:
  1. Start the development servers: `cd frontend && npm run dev` (port 3000)
  2. Navigate to http://localhost:3000/library
  3. Select a project that has clips with TTS text
  4. Look for the "TTS Model" dropdown in the render settings area
  5. Click the dropdown - verify 3 model options appear with names, costs, and latencies
  6. Select "Multilingual v2" - verify the description text updates below the dropdown
  7. Take a Playwright screenshot to document the UI

  Resume signal: Type "approved" if the model selector looks correct, or describe issues to fix.
  </action>
  <verify>Take Playwright screenshot showing the model selector dropdown in the render section.</verify>
  <done>User has visually confirmed the model selector renders correctly with all three options.</done>
</task>

</tasks>

<verification>
1. Model selector dropdown renders in library page render section
2. Three model options displayed with correct names, costs, latencies
3. Default selection is `eleven_flash_v2_5`
4. Selected model sent as `elevenlabs_model` in render FormData
5. TypeScript compiles without errors
6. Visual appearance matches existing dark theme
</verification>

<success_criteria>
- TTS-04 FULLY SATISFIED: User can select ElevenLabs model per render via UI dropdown
- Selected model transmitted to backend render endpoint
- All three models (flash v2.5, turbo v2.5, multilingual v2) available as options
</success_criteria>

<output>
After completion, create `.planning/phases/12-elevenlabs-tts-upgrade/12-03-SUMMARY.md`
</output>
