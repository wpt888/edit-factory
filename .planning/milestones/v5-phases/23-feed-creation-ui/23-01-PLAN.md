---
phase: 23-feed-creation-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/create-feed-dialog.tsx
  - frontend/src/app/products/page.tsx
autonomous: true
requirements:
  - FEED-01
gap_closure: true

must_haves:
  truths:
    - "User can open a Create Feed dialog from the products page and submit a feed name + URL"
    - "After creating a feed, the new feed appears in the feed selector and is auto-selected — no page reload needed"
    - "First-time users with zero feeds see a clear Add Your First Feed button instead of the dead-end Settings text"
    - "Returning users see a New Feed button in the feed bar to add additional feeds"
  artifacts:
    - path: "frontend/src/components/create-feed-dialog.tsx"
      provides: "CreateFeedDialog component with name + feed_url form"
      min_lines: 40
    - path: "frontend/src/app/products/page.tsx"
      provides: "Dialog open state, New Feed button, first-time CTA, onCreated handler"
      contains: "CreateFeedDialog"
  key_links:
    - from: "frontend/src/components/create-feed-dialog.tsx"
      to: "/api/v1/feeds"
      via: "apiPost call on form submit"
      pattern: "apiPost.*feeds"
    - from: "frontend/src/app/products/page.tsx"
      to: "frontend/src/components/create-feed-dialog.tsx"
      via: "import and render with open/onOpenChange/onCreated props"
      pattern: "CreateFeedDialog"
---

<objective>
Create a frontend dialog for adding Google Shopping XML feeds directly from the products page — closing the FEED-01 gap where the backend POST /api/v1/feeds exists but has no frontend caller.

Purpose: First-time users currently see a dead-end "Add a feed in Settings" message with no actionable path. This plan provides the complete create-feed flow inline on the products page.
Output: CreateFeedDialog component + products page wiring (dialog state, New Feed button, first-time CTA, auto-select on creation).
</objective>

<execution_context>
@/home/ukfdb/.claude/get-shit-done/workflows/execute-plan.md
@/home/ukfdb/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-feed-creation-ui/23-RESEARCH.md
@frontend/src/components/create-profile-dialog.tsx
@frontend/src/app/products/page.tsx
@frontend/src/lib/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CreateFeedDialog component</name>
  <files>frontend/src/components/create-feed-dialog.tsx</files>
  <action>
Create `frontend/src/components/create-feed-dialog.tsx` by replicating the exact pattern from `create-profile-dialog.tsx` with these adaptations:

**Props interface:**
```typescript
interface CreateFeedDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onCreated: (feed: any) => void;  // Called with the full feed object from API response
}
```

**Form state:** Two fields — `name` (string, required, min 2 chars) and `feedUrl` (string, required, must start with "http"). Plus `loading` boolean.

**handleCreate function:**
1. Trim `name` and `feedUrl`
2. Validate: name >= 2 chars, feedUrl starts with "http" — show `toast.error` for each
3. Call `apiPost("/feeds", { name: trimmedName, feed_url: trimmedFeedUrl })` — note: backend expects snake_case `feed_url`
4. On success (response.ok): call `toast.success("Feed created successfully")`, call `onCreated(data)` with parsed JSON response, call `onOpenChange(false)`, reset name and feedUrl to empty strings
5. On failure: parse error JSON, show `toast.error(error.detail || "Failed to create feed")`
6. Wrap in try/catch, finally set loading false

**Dialog structure (matching create-profile-dialog.tsx):**
- `<Dialog open={open} onOpenChange={onOpenChange}>`
- `<DialogContent>` with `<DialogHeader>` containing title "Add Feed"
- Two form fields in `<div className="space-y-4 py-4">`:
  - Feed Name: `<Label>` + `<Input>` with placeholder "My Store Feed"
  - Feed URL: `<Label>` + `<Input>` with placeholder "https://example.com/feed.xml"
- `<DialogFooter>` with Cancel button (variant="outline") and Create button (shows "Creating..." when loading)

**Imports:** Dialog/DialogContent/DialogHeader/DialogTitle/DialogFooter from `@/components/ui/dialog`, Button from `@/components/ui/button`, Input from `@/components/ui/input`, Label from `@/components/ui/label`, apiPost from `@/lib/api`, toast from `sonner`, useState from React.

Do NOT use form element with onSubmit — use Button onClick pattern consistent with CreateProfileDialog.
  </action>
  <verify>File exists at `frontend/src/components/create-feed-dialog.tsx`, exports `CreateFeedDialog`, contains `apiPost("/feeds"`, contains two Input fields, contains `onCreated` prop usage.</verify>
  <done>CreateFeedDialog component exists with name + feed_url form fields, apiPost call to /feeds, toast notifications, form reset on close, and onCreated callback.</done>
</task>

<task type="auto">
  <name>Task 2: Wire dialog into products page with New Feed button and first-time CTA</name>
  <files>frontend/src/app/products/page.tsx</files>
  <action>
Modify `frontend/src/app/products/page.tsx` to integrate CreateFeedDialog:

**1. Add imports (top of file):**
- `import { CreateFeedDialog } from "@/components/create-feed-dialog";`
- `import { PlusCircle } from "lucide-react";` (if not already imported)

**2. Add state (inside the main component, near other useState declarations):**
```typescript
const [createFeedOpen, setCreateFeedOpen] = useState(false);
```

**3. Add onCreated handler (near fetchFeeds):**
```typescript
const handleFeedCreated = async (newFeed: any) => {
  // Optimistic update: prepend new feed and auto-select it
  setFeeds((prev) => [newFeed, ...prev]);
  setSelectedFeedId(newFeed.id);
  setSelectedFeed(newFeed);
  // Refresh from server for consistency
  await fetchFeeds();
};
```

**4. Replace the dead-end text** — find the block that renders "No feeds configured. Add a feed in Settings." (around line 408-412) and replace it with a first-time CTA button:
```tsx
{feeds.length === 0 && (
  <Button size="sm" variant="outline" onClick={() => setCreateFeedOpen(true)}>
    <PlusCircle className="h-4 w-4 mr-1" />
    Add Your First Feed
  </Button>
)}
```

**5. Add "New Feed" button** for returning users — place it in the feed bar area, after the Re-sync button or at the end of the feed bar row, visible when `feeds.length > 0`:
```tsx
{feeds.length > 0 && (
  <Button size="sm" variant="outline" onClick={() => setCreateFeedOpen(true)}>
    <PlusCircle className="h-4 w-4 mr-1" />
    New Feed
  </Button>
)}
```

Alternatively, make the button always visible (regardless of feed count) in the bar, AND have the first-time CTA as a separate element. The key is: users always have a way to add a new feed from the products page.

**6. Render the dialog** — add at the end of the component's JSX return, before the closing fragment/div:
```tsx
<CreateFeedDialog
  open={createFeedOpen}
  onOpenChange={setCreateFeedOpen}
  onCreated={handleFeedCreated}
/>
```

**Important:** Do NOT modify any other page or create a settings-based feed management UI. The dialog lives exclusively on the products page.
  </action>
  <verify>
Run `cd frontend && npx playwright test tests/verify-feed-creation.spec.ts --reporter=list` after creating a quick Playwright screenshot test that:
1. Navigates to `/products`
2. Waits for page load
3. Takes a screenshot showing the "Add Your First Feed" button or "New Feed" button is visible
4. Clicks the button to open the dialog
5. Takes a screenshot showing the dialog with name and URL fields

If no test file exists, create `frontend/tests/verify-feed-creation.spec.ts` with the above steps. Take screenshots to `frontend/screenshots/verify-feed-creation.png` and `frontend/screenshots/verify-feed-dialog.png`.
  </verify>
  <done>Products page renders CreateFeedDialog, shows "Add Your First Feed" CTA when no feeds exist, shows "New Feed" button for returning users, and auto-selects newly created feeds via handleFeedCreated callback.</done>
</task>

</tasks>

<verification>
1. Products page loads without errors at http://localhost:3000/products
2. When no feeds exist, "Add Your First Feed" button is visible instead of dead-end text
3. Clicking the button opens a dialog with Feed Name and Feed URL inputs
4. Submitting with valid data calls POST /api/v1/feeds and closes the dialog
5. New feed appears in the feed selector and is auto-selected
6. "New Feed" button visible in feed bar for users who already have feeds
7. Dialog resets form fields when closed and reopened
8. Playwright screenshots confirm visual correctness
</verification>

<success_criteria>
- CreateFeedDialog component exists and follows CreateProfileDialog pattern
- Products page has both first-time CTA and returning-user "New Feed" button
- POST /api/v1/feeds is called with correct payload (name, feed_url in snake_case)
- New feed auto-selects after creation
- No navigation to Settings page required to create a feed
- FEED-01 requirement is fully satisfied from the frontend
</success_criteria>

<output>
After completion, create `.planning/phases/23-feed-creation-ui/23-01-SUMMARY.md`
</output>
